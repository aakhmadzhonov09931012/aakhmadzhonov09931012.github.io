<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <title>2048 o'yini</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #f2f2f2;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h1 {
      margin: 20px;
      font-size: 36px;
      color: #333;
    }
    #game-container {
      background: #bbada0;
      padding: 10px;
      border-radius: 10px;
      display: grid;
      grid-template-columns: repeat(4, 100px);
      grid-gap: 10px;
    }
    .tile {
      width: 100px;
      height: 100px;
      background: #ccc0b3;
      font-size: 32px;
      font-weight: bold;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 5px;
    }
    #reset-btn {
      margin: 15px;
      padding: 10px 20px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
    }
    #reset-btn:hover {
      background: #218838;
    }

    .ads-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, 160px);
      gap: 10px;
      justify-content: center;
      margin-top: 30px;
      padding: 10px;
      width: 100%;
      max-width: 1000px;
    }
  </style>
</head>
<body>
  <h1>2048 Oâ€˜yini</h1>
  <button id="reset-btn">Qayta boshlash</button>
  <div id="game-container"></div>

  <!-- Reklama bannerlari (10 ta Adsterra 160x600) -->
  <div class="ads-container">
    <!-- Takrorlanuvchi scriptlar -->
    <script>
      for (let i = 0; i < 10; i++) {
        const script1 = document.createElement("script");
        script1.type = "text/javascript";
        script1.innerHTML = `
          atOptions = {
            'key' : 'f8dbc3c5a480107e1646ce63fec19cd5',
            'format' : 'iframe',
            'height' : 600,
            'width' : 160,
            'params' : {}
          };
        `;
        const script2 = document.createElement("script");
        script2.type = "text/javascript";
        script2.src = "//www.highperformanceformat.com/f8dbc3c5a480107e1646ce63fec19cd5/invoke.js";

        document.currentScript.parentNode.appendChild(script1);
        document.currentScript.parentNode.appendChild(script2);
      }
    </script>
  </div>

  <script>
    const container = document.getElementById('game-container');
    const resetBtn = document.getElementById('reset-btn');
    let board = [];

    function createBoard() {
      container.innerHTML = '';
      board = [];
      for (let i = 0; i < 16; i++) {
        board.push(0);
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.innerText = '';
        container.appendChild(tile);
      }
      addNumber();
      addNumber();
      updateBoard();
    }

    function addNumber() {
      const emptyIndexes = board.map((val, idx) => val === 0 ? idx : null).filter(v => v !== null);
      if (emptyIndexes.length === 0) return;
      const idx = emptyIndexes[Math.floor(Math.random() * emptyIndexes.length)];
      board[idx] = Math.random() < 0.9 ? 2 : 4;
    }

    function updateBoard() {
      const tiles = container.children;
      for (let i = 0; i < 16; i++) {
        tiles[i].innerText = board[i] === 0 ? '' : board[i];
        tiles[i].style.background = getColor(board[i]);
      }
    }

    function getColor(val) {
      const colors = {
        0: '#ccc0b3', 2: '#eee4da', 4: '#ede0c8', 8: '#f2b179', 16: '#f59563',
        32: '#f67c5f', 64: '#f65e3b', 128: '#edcf72', 256: '#edcc61',
        512: '#edc850', 1024: '#edc53f', 2048: '#edc22e'
      };
      return colors[val] || '#3c3a32';
    }

    function slide(row) {
      row = row.filter(val => val);
      for (let i = 0; i < row.length - 1; i++) {
        if (row[i] === row[i + 1]) {
          row[i] *= 2;
          row[i + 1] = 0;
        }
      }
      return row.filter(val => val).concat(Array(4 - row.filter(val => val).length).fill(0));
    }

    function move(dir) {
      let oldBoard = [...board];
      let newBoard = [];

      if (dir === 'left' || dir === 'right') {
        for (let r = 0; r < 4; r++) {
          let row = board.slice(r * 4, r * 4 + 4);
          if (dir === 'right') row.reverse();
          row = slide(row);
          if (dir === 'right') row.reverse();
          newBoard.push(...row);
        }
      } else {
        for (let c = 0; c < 4; c++) {
          let col = [board[c], board[c + 4], board[c + 8], board[c + 12]];
          if (dir === 'down') col.reverse();
          col = slide(col);
          if (dir === 'down') col.reverse();
          newBoard[c] = col[0];
          newBoard[c + 4] = col[1];
          newBoard[c + 8] = col[2];
          newBoard[c + 12] = col[3];
        }
      }

      if (JSON.stringify(board) !== JSON.stringify(newBoard)) {
        board = newBoard;
        addNumber();
        updateBoard();
      }
    }

    document.addEventListener('keydown', e => {
      switch (e.key) {
        case 'ArrowLeft': move('left'); break;
        case 'ArrowRight': move('right'); break;
        case 'ArrowUp': move('up'); break;
        case 'ArrowDown': move('down'); break;
      }
    });

    resetBtn.addEventListener('click', createBoard);

    createBoard();
  </script>
</body>
</html>
